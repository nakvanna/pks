(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"0SrF":function(e,t,s){"use strict";s.r(t);var a=s("o0o1"),n=s.n(a);function r(e,t,s,a,n,r,i){try{var c=e[r](i),o=c.value}catch(e){return void s(e)}c.done?t(o):Promise.resolve(o).then(a,n)}function i(e){return function(){var t=this,s=arguments;return new Promise((function(a,n){var i=e.apply(t,s);function c(e){r(i,a,n,c,o,"next",e)}function o(e){r(i,a,n,c,o,"throw",e)}c(void 0)}))}}var c,o,d={name:"ServiceInfo",components:{AddServiceInfo:s("mgSd").a},data:function(){return{users:[],selected:[],service_info_extract:[]}},computed:{getServiceInfos:function(){return this.$store.getters.get_service_infos}},created:(o=i(n.a.mark((function e(){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("fetchServiceInfos");case 2:t=this.service_info_extract,this.getServiceInfos.map(function(){var e=i(n.a.mark((function e(s){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.push({id:s.id,year:s.year,student_id:s.students.id,name:s.students.name,latin:s.students.latin,gender:s.students.gender,dob:s.students.dob,service:s.services.type+"-"+s.services.service,date_pay:s.date_pay,last_term:s.last_term,is_used:!0===s.is_used?"នៅប្រើ":"បានផ្អាក"});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)}),methods:{toggleService:(c=i(n.a.mark((function e(){var t,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this).$vs.loading(),s=t.selected.map(function(){var e=i(n.a.mark((function e(s){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("toggleService",s.id);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=5,Promise.all(s).then((function(){t.$vs.notify({time:4e3,title:"ប្រតិបត្តិការជោគជ័យ",text:"ទិន្នន័យបានកែប្រែ",color:"success",iconPack:"feather",icon:"icon-check",position:"top-center"}),t.selected=[],t.$vs.loading.close()}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})}},l=s("KHd+"),v=Object(l.a)(d,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("vx-card",{attrs:{"no-shadow":""}},[s("vs-row",{attrs:{"vs-type":"flex","vs-justify":"flex-end"}},[s("vs-col",{staticClass:"1/2",attrs:{"vs-type":"flex","vs-justify":"flex-start"}},[s("h5",[e._v("ចំនួនដែលបានជ្រើសរើស: "+e._s(e.selected.length))])]),e._v(" "),s("vs-col",{staticClass:"1/2",attrs:{"vs-type":"flex","vs-justify":"flex-end"}},[e.selected.length?s("div",{staticClass:"flex btn-group"},[s("vs-button",{attrs:{type:"relief","icon-pack":"feather",icon:"icon-plus-square"},on:{click:function(t){return e.$refs.addServiceInfo.show(e.selected,!1)}}},[e._v("\n                    បន្ថែមសេវាកម្ម\n                ")]),e._v(" "),s("vs-button",{attrs:{color:"danger",type:"relief","icon-pack":"feather",icon:"icon-refresh-ccw"},on:{click:e.toggleService}},[e._v("\n                    ផ្ដាច់សេវាកម្ម\n                ")])],1):e._e()])],1),e._v(" "),s("vs-divider"),e._v(" "),s("vs-table",{attrs:{multiple:"",pagination:"","max-items":"5",search:"",data:e.service_info_extract},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return e._l(a,(function(t,n){return s("vs-tr",{key:n,attrs:{data:t}},[s("vs-td",{attrs:{data:a[n].year}},[e._v("\n                    "+e._s(a[n].year)+"\n                ")]),e._v(" "),s("vs-td",{attrs:{data:a[n].name}},[e._v("\n                    "+e._s(a[n].name)+"\n                ")]),e._v(" "),s("vs-td",{attrs:{data:a[n].latin}},[e._v("\n                    "+e._s(a[n].latin)+"\n                ")]),e._v(" "),s("vs-td",{attrs:{data:a[n].gender}},[e._v("\n                    "+e._s(a[n].gender)+"\n                ")]),e._v(" "),s("vs-td",{attrs:{data:a[n].dob}},[e._v("\n                    "+e._s(a[n].dob)+"\n                ")]),e._v(" "),s("vs-td",{attrs:{data:a[n].service}},[e._v("\n                    "+e._s(a[n].service)+"\n                ")]),e._v(" "),null!==a[n].date_pay?s("vs-td",{attrs:{data:a[n].date_pay}},[e._v("\n                    "+e._s(a[n].date_pay.substr(0,10))+"\n                ")]):s("vs-td",{attrs:{data:a[n].date_pay}},[e._v("\n                    មិនបានកំណត់\n                ")]),e._v(" "),s("vs-td",{attrs:{data:a[n].is_used}},["នៅប្រើ"===a[n].is_used?s("vs-chip",{attrs:{color:"primary"}},[e._v(e._s(a[n].is_used))]):s("vs-chip",{attrs:{color:"danger"}},[e._v(e._s(a[n].is_used))])],1)],1)}))}}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},[s("template",{slot:"thead"},[s("vs-th",{attrs:{"sort-key":"year"}},[e._v("ឆ្នាំសិក្សា")]),e._v(" "),s("vs-th",{attrs:{"sort-key":"name"}},[e._v("ឈ្មោះសិស្ស")]),e._v(" "),s("vs-th",{attrs:{"sort-key":"latin"}},[e._v("ឈ្មោះឡាតាំ")]),e._v(" "),s("vs-th",{attrs:{"sort-key":"gender"}},[e._v("ភេទ")]),e._v(" "),s("vs-th",{attrs:{"sort-key":"dob"}},[e._v("ថ្ងៃខែឆ្នាំកំណើត")]),e._v(" "),s("vs-th",{attrs:{"sort-key":"class_name"}},[e._v("កំពុងប្រើប្រាស់សេវាកម្ម")]),e._v(" "),s("vs-th",{attrs:{"sort-key":"date_pay"}},[e._v("ថ្ងៃត្រូវបង់លុយ")]),e._v(" "),s("vs-th",{attrs:{"sort-key":"is_used"}},[e._v("ស្ថានភាព")])],1)],2),e._v(" "),s("add-service-info",{ref:"addServiceInfo"})],1)}),[],!1,null,"91a657da",null);t.default=v.exports},mgSd:function(e,t,s){"use strict";var a=s("o0o1"),n=s.n(a),r=s("ksP6"),i=s.n(r),c=(s("Hj/Q"),s("w48C")),o=s.n(c);s("K+Wz");function d(e,t,s,a,n,r,i){try{var c=e[r](i),o=c.value}catch(e){return void s(e)}c.done?t(o):Promise.resolve(o).then(a,n)}function l(e){return function(){var t=this,s=arguments;return new Promise((function(a,n){var r=e.apply(t,s);function i(e){d(r,a,n,i,c,"next",e)}function c(e){d(r,a,n,i,c,"throw",e)}i(void 0)}))}}var v,u,f={name:"addServiceService",components:{flatPickr:o.a,vueDropzone:i.a},data:function(){return{checked:!1,data:{year:"",date_pay:null,last_date_pay:null,service_infos:[{service_id:null}]},student_ids:[],service_infos:[],dropzoneOptions:{url:route("file.upload"),maxFiles:1,addRemoveLinks:!0,dictDefaultMessage:"ដាក់រូបភាពសិស្ស",thumbnailWidth:150,thumbnailHeight:150}}},computed:{getYears:function(){return this.$store.getters.get_years},getServices:function(){return this.$store.getters.get_services}},created:(u=l(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("fetchYears");case 2:return e.next=4,this.$store.dispatch("fetchServices");case 4:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)}),methods:{show:function(e,t){if(this.$modal.show("addServiceService"),!0===t)for(var s=0;s<e.length;s++)this.student_ids.push(e[s].id);else for(var a=0;a<e.length;a++)this.student_ids.push(e[a].student_id)},plus:function(){this.data.service_infos.push({service_id:null})},minus:function(e){this.data.service_infos.splice(e,1)},successUpload:function(e,t){this.data.photo=t.path},clearForm:function(){this.checked=!1,this.data={year:"",date_pay:null,last_date_pay:null,service_infos:[{service_id:null}]}},storeServiceInfo:(v=l(n.a.mark((function e(){var t,s,a,r,i,c,o,d,v;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=this,s=this.data.year,a=this.data.date_pay,r=this.data.last_date_pay,i=this.data.service_infos,c=this.student_ids,o=0;o<c.length;o++)for(d=0;d<i.length;d++)t.service_infos.push({year:s,date_pay:a,last_date_pay:r,student_id:c[o],service_id:i[d].service_id});return this.$vs.loading({type:"material"}),v=t.service_infos.map(function(){var e=l(n.a.mark((function e(s){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("storeServiceInfo",s);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=11,Promise.all(v).then((function(){t.$vs.notify({title:"ប្រតិបត្តិការណ៍ជោគជ័យ",text:"ទិន្នន័យសិស្សត្រូវបានបញ្ចូលក្នុងសេវាកម្ម!",color:"success",iconPack:"feather",icon:"icon-check",position:"top-center"}),t.service_infos=[],t.clearForm(),t.$vs.loading.close()}));case 11:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})}},p=s("KHd+"),_=Object(p.a)(f,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("modal",{attrs:{width:"700",height:"auto",scrollable:!0,pivotY:.2,adaptive:!0,clickToClose:!1,name:"addServiceService"}},[s("div",{staticClass:"flex justify-end"},[s("i",{staticClass:"vs-icon vs-popup--close material-icons text-warning",staticStyle:{background:"rgb(255, 255, 255)"},on:{click:function(t){return e.$modal.hide("addServiceService")}}},[e._v("close")])]),e._v(" "),s("h4",{staticClass:"ml-2"},[s("u",[e._v(" សេវាកម្ម")])]),e._v(" "),s("vx-card",{attrs:{"no-shadow":""}},[s("div",{staticClass:"vx-row"},[s("div",{staticClass:"vx-col lg:w-1/3 w-full"},[s("vs-select",{staticClass:"w-full",attrs:{autocomplete:"",placeholder:"ឆ្នាំសិក្សា",type:"primary"},model:{value:e.data.year,callback:function(t){e.$set(e.data,"year",t)},expression:"data.year"}},e._l(e.getYears,(function(e,t){return s("vs-select-item",{key:t,attrs:{value:e.name,text:e.name}})})),1)],1),e._v(" "),s("div",{staticClass:"vx-col md:w-1/3 flex"},[s("vs-checkbox",{attrs:{color:"#720ea8"},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}}),e._v(" "),s("flat-pickr",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"w-full",attrs:{placeholder:"ថ្ងៃត្រូវបង់លុយដំបូង",name:"date-pay",disabled:!e.checked},model:{value:e.data.date_pay,callback:function(t){e.$set(e.data,"date_pay",t)},expression:"data.date_pay"}})],1),e._v(" "),s("div",{staticClass:"vx-col md:w-1/3 flex"},[s("flat-pickr",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"w-full",attrs:{placeholder:"ថ្ងៃត្រូវបង់លុយដំបូង",name:"date-pay"},model:{value:e.data.last_date_pay,callback:function(t){e.$set(e.data,"last_date_pay",t)},expression:"data.last_date_pay"}})],1)]),e._v(" "),s("vs-divider"),e._v(" "),s("div",{staticClass:"vx-row"},e._l(e.data.service_infos,(function(t,a){return s("div",{key:a,staticClass:"vx-col w-full"},[s("vx-input-group",{staticClass:"mb-base "},[s("div",{staticClass:"flex"},[s("vs-select",{staticClass:"w-5/6",attrs:{autocomplete:"",placeholder:"ជ្រើសរើសសេវាកម្ម"},model:{value:t.service_id,callback:function(s){e.$set(t,"service_id",s)},expression:"service_info.service_id"}},e._l(e.getServices,(function(e,t){return s("vs-select-item",{key:t,attrs:{value:e.id,text:e.type+" -> "+e.service}})})),1),e._v(" "),s("div",{staticClass:"append-text flex w-1/6 btn-addon"},[s("vs-button",{attrs:{color:"danger",type:"relief","icon-pack":"feather",icon:"icon-minus"},on:{click:function(t){return e.minus(a)}}}),e._v(" "),e.data.service_infos.length===a+1?s("vs-button",{attrs:{type:"relief","icon-pack":"feather",icon:"icon-plus"},on:{click:e.plus}}):e._e()],1)],1)])],1)})),0),e._v(" "),s("vs-divider"),e._v(" "),s("div",{staticClass:"flex justify-end btn-group"},[s("vs-button",{attrs:{icon:"icon-save","icon-pack":"feather",type:"relief"},on:{click:e.storeServiceInfo}},[e._v("រក្សាទុក")])],1)],1)],1)}),[],!1,null,"6ece7e26",null);t.a=_.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"8yFd":function(e,t,a){"use strict";var s=a("o0o1"),n=a.n(s),i=a("w48C"),o=a.n(i);a("K+Wz");function r(e,t,a,s,n,i,o){try{var r=e[i](o),c=r.value}catch(e){return void a(e)}r.done?t(c):Promise.resolve(c).then(s,n)}var c,l,d={name:"addStudyInfo",components:{flatPickr:o.a},data:function(){return{checked:!1,data:{year:{name:"2019-2020",id:null},date_pay:null,last_date_pay:null,study_infos:[{collection_id:null}],students:[]}}},computed:{getYears:function(){return this.$store.getters.get_years},getCollection:function(){return this.$store.getters.get_collections},filteredCollection:function(){var e=this;return e.getCollection.filter((function(t){return t.year===e.data.year.name})).map((function(e){return{id:e.id,item_data:"(".concat(e.year,")-").concat(e.group_section,"-").concat(e.section,"-").concat(e.level).concat(e.class_name,"-(").concat(e.shift,")"),class_name:"".concat(e.level).concat(e.class_name)}}))}},methods:{show:function(e){this.$modal.show("add-study-info"),this.data.students=e},plus:function(){this.data.study_infos.push({collection_id:null})},minus:function(e){this.data.study_infos.splice(e,1)},clearForm:function(){this.checked=!1,this.data={year:"",date_pay:null,last_date_pay:null,study_infos:[{collection_id:null}]}},storeStudyInfo:(c=n.a.mark((function e(){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this,this.$validator.validateAll().then((function(e){e?(t.$vs.loading(),t.$store.dispatch("storeStudyInfo",t.data).then((function(e){e?(t.$vs.notify({time:4e3,title:"ប្រតិបត្តិការជោគជ័យ",text:"ទិន្នន័យបានបន្ថែម",color:"success",iconPack:"feather",icon:"icon-check",position:"top-center"}),t.$emit("finished"),t.resetField()):t.$vs.notify({title:"ប្រតិបត្តិការបរាជ័យ",text:"ទិន្នន័យមិនបានបន្ថែម",color:"danger",iconPack:"feather",icon:"icon-message-square",position:"top-center"}),t.$vs.loading.close()}))):t.$vs.notify({title:"ប្រតិបត្តិការបរាជ័យ",text:"សូមបំពេញទិន្នន័យអោយបានត្រឹមត្រូវ",color:"danger",iconPack:"feather",icon:"icon-message-square",position:"top-center"})}));case 2:case"end":return e.stop()}}),e,this)})),l=function(){var e=this,t=arguments;return new Promise((function(a,s){var n=c.apply(e,t);function i(e){r(n,a,s,i,o,"next",e)}function o(e){r(n,a,s,i,o,"throw",e)}i(void 0)}))},function(){return l.apply(this,arguments)}),resetField:function(){this.data={year:{name:"2019-2020",id:null},date_pay:null,last_date_pay:null,study_infos:[{collection_id:null}],students:[]}}}},u=a("KHd+"),f=Object(u.a)(d,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("modal",{attrs:{width:"700",height:"auto",scrollable:!0,pivotY:.2,adaptive:!0,clickToClose:!1,name:"add-study-info"}},[a("div",{staticClass:"flex justify-end"},[a("i",{staticClass:"vs-icon vs-popup--close material-icons text-warning",staticStyle:{background:"rgb(255, 255, 255)"},on:{click:function(t){return e.$modal.hide("add-study-info")}}},[e._v("close")])]),e._v(" "),a("vx-card",{attrs:{"no-shadow":""}},[a("div",{staticClass:"vx-row"},[a("div",{staticClass:"vx-col w-full"},[a("h4",{staticClass:"mb-base"},[e._v("ចំនួនសិស្សដែលបានជ្រើសរើស៖  "),a("b",[e._v(e._s(e.data.students.length))]),e._v(" នាក់")])])]),e._v(" "),a("div",{staticClass:"vx-row"},[a("div",{staticClass:"vx-col lg:w-1/3 w-full"},[a("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"w-full",attrs:{clearable:!1,name:"year",placeholder:"ជ្រើសរើសឆ្នាំ",label:"name",options:e.getYears},model:{value:e.data.year,callback:function(t){e.$set(e.data,"year",t)},expression:"data.year"}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("year"),expression:"errors.has('year')"}],staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("year")))])],1),e._v(" "),a("div",{staticClass:"vx-col md:w-1/3 w-full"},[a("div",{staticClass:"flex"},[a("vs-checkbox",{model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}}),e._v(" "),a("flat-pickr",{directives:[{name:"validate",rawName:"v-validate",value:e.checked?"required":"",expression:"checked?'required':''"}],staticClass:"w-full",attrs:{placeholder:"ថ្ងៃត្រូវបង់លុយដំបូង",name:"date_pay",disabled:!e.checked},model:{value:e.data.date_pay,callback:function(t){e.$set(e.data,"date_pay",t)},expression:"data.date_pay"}})],1),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("date_pay"),expression:"errors.has('date_pay')"}],staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("date_pay")))])]),e._v(" "),a("div",{staticClass:"vx-col md:w-1/3 w-full"},[a("flat-pickr",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"w-full",attrs:{placeholder:"ថ្ងៃត្រូវបង់ចុងក្រោយ",name:"last_date_pay"},model:{value:e.data.last_date_pay,callback:function(t){e.$set(e.data,"last_date_pay",t)},expression:"data.last_date_pay"}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("last_date_pay"),expression:"errors.has('last_date_pay')"}],staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("last_date_pay")))])],1)]),e._v(" "),a("vs-divider"),e._v(" "),a("div",{staticClass:"vx-row"},[e._l(e.data.study_infos,(function(t,s){return a("div",{key:s,staticClass:"vx-col w-full mb-2"},[a("vx-input-group",[a("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"study_info-"+s,placeholder:"ជ្រើសរើសពត៍មានការសិក្សា",label:"item_data",options:e.filteredCollection},model:{value:t.collection_id,callback:function(a){e.$set(t,"collection_id",a)},expression:"item.collection_id"}}),e._v(" "),1!==e.data.study_infos.length?a("template",{slot:"append"},[a("div",{staticClass:"append-text btn-addon"},[a("vs-button",{attrs:{"icon-pack":"feather",icon:"icon-minus-square",color:"warning",type:"flat"},on:{click:function(t){return e.minus(s)}}})],1)]):e._e()],2),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("study_info-"+s),expression:"errors.has(`study_info-${index}`)"}],staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("study_info-"+s)))])],1)})),e._v(" "),a("div",{staticClass:"vx-col w-full"},[a("vs-button",{attrs:{"icon-pack":"feather",type:"line"},on:{click:e.plus}},[e._v("បន្ថែមជួរ")])],1)],2),e._v(" "),a("vs-divider"),e._v(" "),a("div",{staticClass:"flex justify-end btn-group"},[a("vs-button",{attrs:{icon:"icon-save","icon-pack":"feather",type:"relief"},on:{click:e.storeStudyInfo}},[e._v("រក្សាទុក\n            ")])],1)],1)],1)}),[],!1,null,"f1465368",null);t.a=f.exports},hrn2:function(e,t,a){"use strict";a.r(t);var s=a("o0o1"),n=a.n(s),i=a("8yFd"),o=a("w48C"),r=a.n(o);a("K+Wz");function c(e,t,a,s,n,i,o){try{var r=e[i](o),c=r.value}catch(e){return void a(e)}r.done?t(c):Promise.resolve(c).then(s,n)}var l,d,u={name:"changeStudyInfo",components:{flatPickr:r.a},data:function(){return{checked:!1,data:{year:{name:"2020-2021",id:null},date_change:null,study_infos:[{collection_id:null}],students:[]}}},computed:{getYears:function(){return this.$store.getters.get_years},getCollection:function(){return this.$store.getters.get_collections},filteredCollection:function(){var e=this;return e.getCollection.filter((function(t){return t.year===e.data.year.name})).map((function(e){return{id:e.id,item_data:"(".concat(e.year,")-").concat(e.group_section,"-").concat(e.section,"-").concat(e.level).concat(e.class_name),class_name:"".concat(e.level).concat(e.class_name)}}))}},methods:{show:function(e){this.$modal.show("change-study-info"),this.data.students=e,console.log(this.data)},plus:function(){this.data.study_infos.push({collection_id:null})},minus:function(e){this.data.study_infos.splice(e,1)},clearForm:function(){this.checked=!1,this.data={year:"",date_pay:null,last_date_pay:null,study_infos:[{collection_id:null}]}},storeChangeStudyInfo:(l=n.a.mark((function e(){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this,this.$validator.validateAll().then((function(e){e?(t.$vs.loading(),t.$store.dispatch("storeChangeStudyInfo",t.data).then((function(e){e?(t.$vs.notify({time:4e3,title:"ប្រតិបត្តិការជោគជ័យ",text:"ទិន្នន័យបានបន្ថែម",color:"success",iconPack:"feather",icon:"icon-check",position:"top-center"}),t.$emit("finished")):t.$vs.notify({title:"ប្រតិបត្តិការបរាជ័យ",text:"ទិន្នន័យមិនបានបន្ថែម",color:"danger",iconPack:"feather",icon:"icon-message-square",position:"top-center"}),t.$vs.loading.close()}))):t.$vs.notify({title:"ប្រតិបត្តិការបរាជ័យ",text:"សូមបំពេញទិន្នន័យអោយបានត្រឹមត្រូវ",color:"danger",iconPack:"feather",icon:"icon-message-square",position:"top-center"})}));case 2:case"end":return e.stop()}}),e,this)})),d=function(){var e=this,t=arguments;return new Promise((function(a,s){var n=l.apply(e,t);function i(e){c(n,a,s,i,o,"next",e)}function o(e){c(n,a,s,i,o,"throw",e)}i(void 0)}))},function(){return d.apply(this,arguments)})}},f=a("KHd+"),v=Object(f.a)(u,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("modal",{attrs:{width:"700",height:"auto",scrollable:!0,pivotY:.2,adaptive:!0,clickToClose:!1,name:"change-study-info"}},[a("div",{staticClass:"flex justify-end"},[a("i",{staticClass:"vs-icon vs-popup--close material-icons text-warning",staticStyle:{background:"rgb(255, 255, 255)"},on:{click:function(t){return e.$modal.hide("change-study-info")}}},[e._v("close")])]),e._v(" "),a("h4",{staticClass:"ml-2"},[a("u",[e._v(" ការសិក្សា")])]),e._v(" "),a("vx-card",{attrs:{"no-shadow":""}},[a("div",{staticClass:"vx-row"},[a("div",{staticClass:"vx-col lg:w-1/3 w-full"},[a("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"w-full",attrs:{clearable:!1,name:"year",placeholder:"ជ្រើសរើសឆ្នាំ",label:"name",options:e.getYears},model:{value:e.data.year,callback:function(t){e.$set(e.data,"year",t)},expression:"data.year"}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("year"),expression:"errors.has('year')"}],staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("year")))])],1),e._v(" "),a("div",{staticClass:"vx-col md:w-1/3 w-full"},[a("flat-pickr",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"w-full",attrs:{placeholder:"ថ្ងៃខែឆ្នាំប្តូរ",name:"date_change"},model:{value:e.data.date_change,callback:function(t){e.$set(e.data,"date_change",t)},expression:"data.date_change"}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("date_change"),expression:"errors.has('date_change')"}],staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("date_change")))])],1)]),e._v(" "),a("vs-divider"),e._v(" "),a("div",{staticClass:"vx-row"},[e._l(e.data.study_infos,(function(t,s){return a("div",{key:s,staticClass:"vx-col w-full mb-2"},[a("vx-input-group",[a("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"study_info-"+s,placeholder:"ជ្រើសរើសពត៍មានការសិក្សា",label:"item_data",options:e.filteredCollection},model:{value:t.collection_id,callback:function(a){e.$set(t,"collection_id",a)},expression:"item.collection_id"}}),e._v(" "),1!==e.data.study_infos.length?a("template",{slot:"append"},[a("div",{staticClass:"append-text btn-addon"},[a("vs-button",{attrs:{"icon-pack":"feather",icon:"icon-minus-square",color:"warning",type:"flat"},on:{click:function(t){return e.minus(s)}}})],1)]):e._e()],2),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("study_info-"+s),expression:"errors.has(`study_info-${index}`)"}],staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("study_info-"+s)))])],1)})),e._v(" "),a("div",{staticClass:"vx-col w-full"},[a("vs-button",{attrs:{"icon-pack":"feather",type:"line"},on:{click:e.plus}},[e._v("បន្ថែមជួរ")])],1)],2),e._v(" "),a("vs-divider"),e._v(" "),a("div",{staticClass:"flex justify-end btn-group"},[a("vs-button",{attrs:{icon:"icon-save","icon-pack":"feather",type:"relief"},on:{click:e.storeChangeStudyInfo}},[e._v("រក្សាទុក\n            ")])],1)],1)],1)}),[],!1,null,"bcab2c80",null).exports,p=a("QBvj");a("7emp");function h(e,t,a,s,n,i,o){try{var r=e[i](o),c=r.value}catch(e){return void a(e)}r.done?t(c):Promise.resolve(c).then(s,n)}function _(e){return function(){var t=this,a=arguments;return new Promise((function(s,n){var i=e.apply(t,a);function o(e){h(i,s,n,o,r,"next",e)}function r(e){h(i,s,n,o,r,"throw",e)}o(void 0)}))}}var y,m={name:"StudyYear",components:{ChangeStudyInfo:v,AddStudyInfo:i.a,AgGridVue:p.AgGridVue},data:function(){return{selected:[],gridApi:null,columnDefs:[{headerName:"ឆ្នាំសិក្សា",field:"year",checkboxSelection:!0,pinned:!0},{headerName:"ឈ្មោះសិស្ស",field:"name"},{headerName:"ឈ្មោះឡាតាំ",field:"latin"},{headerName:"ភេទ",field:"gender"},{headerName:"ថ្ងៃខែឆ្នាំកំណើត",field:"dob"},{headerName:"កំពុងរៀនថ្នាក់ទី",field:"class_name"},{headerName:"ពេលសិក្សា",field:"shift"},{headerName:"ថ្ងៃត្រូវបង់លុយ",field:"date_pay"},{headerName:"ចំនួនថ្ងៃនៅសល់",field:"day_left",cellRenderer:function(e){return e.data.day_left<0?'<span class="text-danger"><b>'.concat(e.data.day_left,"</b></span>"):e.data.day_left<=5?'<span class="text-warning"><b>'.concat(e.data.day_left,"</b></span>"):'<span class="text-success"><b>'.concat(e.data.day_left,"</b></span>")}}],defaultColDef:{sortable:!0,resizable:!0,filter:!0}}},methods:{onGridReady:function(e){this.gridApi=e.api},onSelectionChanged:function(){this.selected=this.gridApi.getSelectedRows()},confirmDelete:function(){this.$vs.dialog({color:"danger",title:"លុបទិន្នន័យ?",text:"ចុចពាក្យ Accept ដើម្បីយល់ព្រម!",accept:this.deleteStudyYear})},deleteStudyYear:(y=_(n.a.mark((function e(){var t,a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(t=this).selected.map(function(){var e=_(n.a.mark((function e(a){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==parseInt(a.last_term)){e.next=3;break}return e.next=3,t.$store.dispatch("destroyStudyInfo",a.study_info_id);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(a).then((function(){t.$vs.notify({title:"ប្រតិបត្តិការណ៍ជោគជ័យ",text:"ទិន្នន័យត្រូវបានលុប!",color:"success",iconPack:"feather",icon:"icon-check",position:"top-center"}),t.selected=[],t.$vs.loading.close()}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},computed:{getStudyInfos:function(){return this.$store.getters.get_study_infos},study_info_extract:function(){var e=this;return this.getStudyInfos.map((function(t){var a=e.moment(),s=e.moment(t.date_pay);return!e.getStudyInfos.length||{study_info_id:t.id,id:t.students.id,year:t.year,student_id:t.students.id,name:t.students.name,latin:t.students.latin,gender:t.students.gender,dob:t.students.dob,class_name:t.study_infos.level+t.study_infos.class_name,shift:t.study_infos.shift,date_pay:t.date_pay,last_date_pay:t.last_date_pay,last_term:t.last_term,to_class:t.to_class,day_left:s.diff(a,"days")}}))}}},g=Object(f.a)(m,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("vx-card",{attrs:{"no-shadow":""}},[a("vs-row",{attrs:{"vs-type":"flex","vs-justify":"flex-end"}},[a("vs-col",{staticClass:"1/2",attrs:{"vs-type":"flex","vs-justify":"flex-start"}},[a("h5",[e._v("ចំនួនដែលបានជ្រើសរើស: "+e._s(e.selected.length))])]),e._v(" "),a("vs-col",{staticClass:"1/2",attrs:{"vs-type":"flex","vs-justify":"flex-end"}},[e.selected.length?a("div",{staticClass:"flex btn-group"},[a("vs-button",{attrs:{type:"relief","icon-pack":"feather",icon:"icon-plus-square"},on:{click:function(t){return e.$refs.addStudyInfo.show(e.selected)}}},[e._v("\n                    ឡើងថ្នាក់\n                ")]),e._v(" "),a("vs-button",{attrs:{color:"warning",type:"relief","icon-pack":"feather",icon:"icon-edit"},on:{click:function(t){return e.$refs.changeStudyInfo.show(e.selected)}}},[e._v("\n                    ប្តូរថ្នាក់\n                ")]),e._v(" "),a("vs-button",{attrs:{color:"danger",type:"relief","icon-pack":"feather",icon:"icon-trash"},on:{click:e.confirmDelete}},[e._v("\n                    លុប\n                ")])],1):e._e()])],1),e._v(" "),a("vs-divider"),e._v(" "),a("ag-grid-vue",{staticClass:"ag-theme-material w-100 my-4 ag-grid-table",attrs:{columnDefs:e.columnDefs,defaultColDef:e.defaultColDef,rowSelection:"multiple",pagination:!0,paginationPageSize:100,animateRows:!0,rowData:e.study_info_extract},on:{"grid-ready":e.onGridReady,"selection-changed":e.onSelectionChanged}}),e._v(" "),a("add-study-info",{ref:"addStudyInfo",on:{finished:function(t){e.selected=[]}}}),e._v(" "),a("change-study-info",{ref:"changeStudyInfo",on:{finished:function(t){e.selected=[]}}})],1)}),[],!1,null,"0d5bd1c0",null);t.default=g.exports}}]);